<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout</title>
    <link
      href="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp,container-queries"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
    />
    <style>
      input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
      .fullscreen-loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.7); /* Hitam dengan transparansi */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999; /* Pastikan loader berada di atas semua elemen */
      }

      .loader {
        width: 50px;
        aspect-ratio: 1;
        border-radius: 50%;
        background: radial-gradient(
              farthest-side,
              rgba(255, 255, 255, 0.7) 94%,
              transparent
            )
            top/8px 8px no-repeat,
          conic-gradient(transparent 30%, rgba(255, 255, 255, 0.9));
        -webkit-mask: radial-gradient(
          farthest-side,
          transparent calc(100% - 8px),
          #000 0
        );
        animation: l13 1s infinite linear;
      }

      @keyframes l13 {
        100% {
          transform: rotate(1turn);
        }
      }
    </style>
  </head>
  <body>
    <div id="fullscreen-loader" class="fullscreen-loader hidden">
      <div class="loader"></div>
    </div>
    <nav class="bg-gray-900 shadow">
      <div
        class="max-w-screen-xl flex items-center justify-between mx-auto p-5"
      >
        <!-- Logo, displayed only on md and larger screens -->
        <a
          href="index.html"
          class="hidden md:flex items-center space-x-3 rtl:space-x-reverse"
        >
          <img
            src="https://flowbite.com/docs/images/logo.svg"
            class="h-8"
            alt="Flowbite Logo"
          />
          <span
            class="self-center text-2xl font-semibold whitespace-nowrap text-white"
            >E-commerce</span
          >
        </a>

        <!-- Centered Full-width Search Bar -->
        <div class="flex-1 flex justify-center pe-5">
          <div class="relative w-full max-w-lg">
            <div
              class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none"
            >
              <svg
                class="w-4 h-4 text-gray-400"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 20 20"
              >
                <path
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"
                />
              </svg>
              <span class="sr-only">Search icon</span>
            </div>
            <input
              type="text"
              id="search-navbar"
              class="block w-full p-2 ps-10 text-sm border rounded-lg focus:ring-blue-500 focus:border-blue-500 bg-gray-700 border-gray-600 placeholder-gray-400 text-white"
              placeholder="Search..."
            />
          </div>
        </div>

        <!-- Right Side: Cart and User Profile -->
        <div
          class="flex items-center space-x-5 md:space-x-10 rtl:space-x-reverse"
        >
          <!-- Favorite Icon -->
          <a href="favorite.html">
            <button
              type="button"
              class="text-gray-400 hover:text-white focus:outline-none"
              aria-label="View favorite"
            >
              <i class="fa-solid fa-heart text-xl"></i>
            </button>
          </a>
            <!-- Shopping Cart Icon -->
          <a href="cart.html">
            <button
              type="button"
              class="text-gray-400 hover:text-white focus:outline-none"
              aria-label="View cart"
            >
              <i class="fas fa-shopping-cart text-xl"></i>
            </button>
          </a>

          <!-- User Profile Icon and Dropdown Menu -->
          <button
            type="button"
            class="flex text-sm bg-gray-800 rounded-full focus:ring-4 focus:ring-gray-600"
            id="user-menu-button"
            aria-expanded="false"
            data-dropdown-toggle="user-dropdown"
            data-dropdown-placement="bottom"
          >
            <span class="sr-only">Open user menu</span>
            <img
              class="w-8 h-8 rounded-full"
              src="https://static.vecteezy.com/system/resources/thumbnails/019/900/306/small_2x/happy-young-cute-illustration-face-profile-png.png"
              alt="user photo"
            />
          </button>

          <!-- Dropdown menu -->
          <div
            class="z-50 hidden my-4 text-base list-none divide-y rounded-lg shadow bg-gray-700 divide-gray-600"
            id="user-dropdown"
          >
            <div class="px-4 py-3">
              <span class="block text-sm text-white">Bonnie Green</span>
              <span class="block text-sm truncate text-gray-400"
                >name@flowbite.com</span
              >
            </div>
            <ul class="py-2" aria-labelledby="user-menu-button">
              <li>
                <a
                  href="#"
                  class="block px-4 py-2 text-sm hover:bg-gray-600 text-gray-200 hover:text-white"
                  >Dashboard</a
                >
              </li>
              <li>
                <a
                  href="#"
                  class="block px-4 py-2 text-sm hover:bg-gray-600 text-gray-200 hover:text-white"
                  >Settings</a
                >
              </li>
              <li>
                <a
                  href="#"
                  class="block px-4 py-2 text-sm hover:bg-gray-600 text-gray-200 hover:text-white"
                  >Earnings</a
                >
              </li>
              <li>
                <a
                  href="#"
                  class="block px-4 py-2 text-sm hover:bg-gray-600 text-gray-200 hover:text-white"
                  >Sign out</a
                >
              </li>
            </ul>
          </div>
        </div>
      </div>
    </nav>

    <div class="checkout px-28 py-8 bg-gray-50">
      <p class="text-3xl font-bold">Pengiriman</p>
      <div class="flex flex-row">
        <div class="details">
          <!-- Alamat -->
          <div
            class="my-5 w-full max-w-4xl bg-white border border-gray-200 rounded-lg shadow"
          >
            <div class="header px-2 pt-4 flex items-center">
              <label
                class="ms-5 text-xl font-semibold text-gray-400"
                >Alamat Pengiriman</label
              >
            </div>

            <!-- Pengirim -->
            <div class="px-6 pt-4 pb-3">
              <div class="nama-pengirim flex items-center space-x-2">
                <svg
                  class="w-5 h-5 text-gray-800"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    fill-rule="evenodd"
                    d="M11.906 1.994a8.002 8.002 0 0 1 8.09 8.421 7.996 7.996 0 0 1-1.297 3.957.996.996 0 0 1-.133.204l-.108.129c-.178.243-.37.477-.573.699l-5.112 6.224a1 1 0 0 1-1.545 0L5.982 15.26l-.002-.002a18.146 18.146 0 0 1-.309-.38l-.133-.163a.999.999 0 0 1-.13-.202 7.995 7.995 0 0 1 6.498-12.518ZM15 9.997a3 3 0 1 1-5.999 0 3 3 0 0 1 5.999 0Z"
                    clip-rule="evenodd"
                  />
                </svg>
                <p id="nama" class="text-md font-semibold"></p>
              </div>
              <div class="alamat py-2 px-2">
                <p id="alamat"></p>
              </div>
            </div>

            <!-- Ganti alamat -->
            <div class="ganti-alamat px-7 pb-5">
              <!-- Modal toggle -->
              <button
                data-modal-target="authentication-modal"
                data-modal-toggle="authentication-modal"
                class="block text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center"
                type="button"
              >
                Ganti alamat
              </button>

              <!-- Main modal -->
              <div
                id="authentication-modal"
                tabindex="-1"
                aria-hidden="true"
                class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full"
              >
                <div class="relative p-4 w-full max-w-xl max-h-full">
                  <!-- Modal content -->
                  <div
                    class="relative bg-white rounded-lg shadow"
                  >
                    <!-- Modal header -->
                    <div
                      class="flex items-center justify-between p-4 md:p-5 border-b rounded-t"
                    >
                      <h3
                        class="text-xl font-semibold text-gray-900"
                      >
                        Daftar alamat pengiriman
                      </h3>
                      <button
                        type="button"
                        class="end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center"
                        data-modal-hide="authentication-modal"
                      >
                        <svg
                          class="w-3 h-3"
                          aria-hidden="true"
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 14 14"
                        >
                          <path
                            stroke="currentColor"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
                          />
                        </svg>
                        <span class="sr-only">Close modal</span>
                      </button>
                    </div>

                    <!-- Modal body -->
                    <div class="p-4 md:p-5">
                      <!-- List alamat -->
                      <div id="addresses-container" class="space-y-4 mb-5">
                      </div>

                      <!-- Tambah alamat baru -->
                      <button
                          type="button"
                          data-modal-target="input-alamat-modal"
                          data-modal-toggle="input-alamat-modal"
                          id="input-alamat-toogle"
                          class="flex items-center w-52 text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center"
                        >
                          <span class="mr-2">
                            <svg
                              class="w-5 h-5 text-white"
                              aria-hidden="true"
                              xmlns="http://www.w3.org/2000/svg"
                              width="24"
                              height="24"
                              fill="none"
                              viewBox="0 0 24 24"
                            >
                              <path
                                stroke="currentColor"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M5 12h14m-7 7V5"
                              />
                            </svg>
                          </span>
                          Tambah alamat baru
                        </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Input Alamat -->
              <div
                id="input-alamat-modal"
                tabindex="-1"
                aria-hidden="true"
                class="hidden modal modal-input fixed inset-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full"
              >
                <div class="relative p-4 w-full max-w-xl max-h-full">
                  <div
                    class="relative bg-white rounded-lg shadow"
                  >
                    <!-- Modal header -->
                    <div
                      class="p-4 md:p-5 border-b rounded-t"
                    >
                      <h3
                        class="text-xl font-semibold text-gray-900"
                      >
                        Tambah alamat baru
                      </h3>
                    </div>
                    <!-- Modal body -->
                    <div class="p-4 md:p-5 overflow-y-auto max-h-[70vh]">
                      <!-- Added max-h and overflow-y-auto here -->
                      <form>
                        <label class="text-sm font-semibold" for="Nama"
                          >Nama</label
                        >
                        <input
                        id="Nama"
                          type="text"
                          class="w-full mb-4 p-2 border rounded"
                        />
                        <label class="text-sm font-semibold" for="Telepon"
                          >Telepon</label
                        >
                        <input
                        id="Telepon"
                          type="number"
                          class="w-full mb-4 p-2 border rounded"
                        />
                        <label class="text-sm font-semibold" for="Alamat"
                          >Alamat</label
                        >
                        <input
                        id="Alamat"
                          type="text"
                          class="w-full mb-4 p-2 border rounded"
                        />
                        <label class="text-sm font-semibold" for="Kelurahan"
                          >Kelurahan</label
                        >
                        <input
                        id="Kelurahan"
                          type="text"
                          class="w-full mb-4 p-2 border rounded"
                        />
                        <label class="text-sm font-semibold" for="Kecamatan"
                          >Kecamatan</label
                        >
                        <input
                        id="Kecamatan"
                          type="text"
                          class="w-full mb-4 p-2 border rounded"
                        />
                        <label class="text-sm font-semibold" for="Kota"
                          >Kota</label
                        >
                        <input
                        id="Kota"
                          type="text"
                          class="w-full mb-4 p-2 border rounded"
                        />
                        <label class="text-sm font-semibold" for="Provinsi"
                          >Provinsi</label
                        >
                        <input
                        id="Provinsi"
                          type="text"
                          class="w-full mb-4 p-2 border rounded"
                        />
                        <label class="text-sm font-semibold" for="KodePos"
                          >Kode pos</label
                        >
                        <input
                        id="KodePos"
                          type="number"
                          class="w-full mb-4 p-2 border rounded"
                        />
                        <div class="flex justify-between">
                          <button
                            type="submit"
                            class="text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center"
                            data-modal-hide="input-alamat-modal"
                          >
                            Simpan
                          </button>
                          <button
                            type="button"
                            id="cancelInputAlamat"
                            class="text-white bg-gray-500 hover:bg-gray-600 focus:ring-4 focus:outline-none focus:ring-gray-400 font-medium rounded-lg text-sm px-5 py-2.5 text-center"
                            data-modal-hide="input-alamat-modal"
                          >
                            Batal
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Produk -->
          <div
            class="product-card my-5 w-full max-w-4xl bg-white border border-gray-200 rounded-lg shadow"
          >
            <div class="container-item">
              <!-- Header Toko -->
            </div>

            <div class="ekspedisi">
              <div class="header px-2 pt-4 flex items-center">
                <label
                  class="ms-5 text-md font-semibold text-gray-400"
                  >Pilih Pengiriman</label
                >
              </div>
              <div class="pilihan-ekspedisi px-7 py-4">
                <!-- Dropdown -->
                <select
                  id="ekspedisiDropdown"
                  class="w-full p-2 border rounded-lg bg-gray-100 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="reguler" selected>Reguler (Rp 21.500)</option>
                  <option value="kargo">Kargo (Rp 60.000)</option>
                  <option value="ekonomi">Ekonomi (Rp 14.000)</option>
                </select>
                <!-- Detail Ekspedisi -->
                <div id="ekspedisiDetail" class="mt-4 px-1 hidden space-y-2">
                  <h3
                    id="ekspedisiName"
                    class="text-lg font-medium text-gray-900"
                  ></h3>
                  <p
                    id="ekspedisiEstimasi"
                    class="text-md font-normal text-gray-900"
                  ></p>
                  <p
                    id="ekspedisiInfo"
                    class="text-md font-normal text-gray-400"
                  ></p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Order Summary -->
        <div
          class="mx-auto pt-5 pl-8 max-w-4xl flex-1 space-y-6 lg:mt-0 lg:w-full"
        >
          <div
            class="space-y-4 rounded-lg border border-gray-200 bg-white p-4 shadow-sm sm:p-6"
          >
            <p class="text-xl font-semibold text-gray-900">
              Ringkasan belanja
            </p>

            <div class="space-y-4">
              <div class="space-y-2">
                <dl
                  class="flex items-center justify-between gap-4 border-t border-gray-200 pt-2"
                >
                  <dt
                    class="text-base font-normal text-gray-900"
                  >
                    Total Harga
                  </dt>
                  <dd
                    class="total-harga text-base font-normal text-gray-900"
                  ></dd>
                </dl>
                <dl
                  class="flex items-center justify-between gap-4"
                >
                  <dt
                    class="text-base font-normal text-gray-900"
                  >
                    Total Ongkos Kirim
                  </dt>
                  <dd
                    class="ongkir text-base font-normal text-gray-900"
                  >
                  </dd>
                </dl>
                <dl
                  class="flex items-center justify-between gap-4"
                >
                  <dt
                    class="text-base font-normal text-gray-900"
                  >
                    Biaya Platform
                  </dt>
                  <dd
                    class="text-base font-normal text-gray-900"
                  >
                    Rp 1.000
                  </dd>
                </dl>
                <dl
                  class="flex items-center justify-between gap-4 border-t border-gray-200 pt-2"
                >
                  <dt
                    class="text-base font-normal text-gray-900"
                  >
                    Total Tagihan
                  </dt>
                  <dd
                    class="total-tagihan text-base font-normal text-gray-900"
                  ></dd>
              </div>

              <!-- Metode pembayaran -->
              <div class="metode-pembayaran">
                <div class="header px-1 pt-4 flex items-center">
                  <label
                    class="text-md font-semibold text-gray-400"
                    >Pilih Metode Pembayaran</label
                  >
                </div>
                <div class="pilihan-pembayaran px-1 py-4">
                  <!-- Dropdown -->
                  <select
                    id="pembayaranDropdown"
                    class="w-full p-2 border rounded-lg bg-gray-100 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  >
                    <option value="" selected>
                      Pilih salah satu metode pembayaran
                    </option>
                    <option value="transfer">Transfer Bank</option>
                    <option value="cod">Bayar di Tempat (COD)</option>
                    <option value="ewallet">E-Wallet</option>
                  </select>
                  <!-- Detail Pembayaran -->
                  <div id="pembayaranDetail" class="mt-4 hidden space-y-2">
                    <h3
                      id="pembayaranName"
                      class="text-lg font-medium text-gray-900"
                    ></h3>
                    <p
                      id="pembayaranInfo"
                      class="text-md font-normal text-gray-900"
                    ></p>
                  </div>
                </div>
              </div>

              <a
                href="checkout.html"
                class="flex w-full items-center justify-center rounded-lg bg-blue-600 hover:bg-blue-700 px-5 py-2.5 text-sm font-medium text-white hover:bg-primary-800 focus:outline-none focus:ring-4 focus:ring-primary-300"
                >Bayar</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    let total_harga = 0;
    var tmpTagihan = 0;

// API Fetch and Rendering
document.addEventListener("DOMContentLoaded", function () {
  const total_harga_text = document.querySelector(".total-harga");

  const params = new URLSearchParams(window.location.search);
  const name = params.get("name");
  const qty = params.get("qty");

  // Validasi parameter
  if ((name && !qty) || (!name && qty)) {
    alert(
      "Invalid parameter: Both 'name' and 'qty' must be provided, or none at all."
    );
    window.location.href = "index.html";
    return;
  }

  async function fetchData() {
    try {
      let url =
        "https://2y33ouer8f.execute-api.us-east-1.amazonaws.com/default/get_checkout";
      if (name && qty) {
        url += `?name=${encodeURIComponent(name)}&qty=${encodeURIComponent(
          qty
        )}`;
      }

      const response = await fetch(url);
      if (!response.ok) {
        throw new Error("Network response was not ok");
      }

      const result = await response.json();
      console.log("API Data:", result);

      const container = document.querySelector(".container-item");
      container.innerHTML = ""; // Bersihkan kontainer sebelum menambahkan konten

      if (Array.isArray(result.data)) {
        result.data.forEach((item) => {
          total_harga += Number(item.total_price);
          const itemHtml = `
          <div class="header store-name px-2 py-4 flex items-center">
            <label class="ms-5 text-md font-bold text-gray-900">
              ${item.store}
            </label>
          </div>
          <div class="content grid grid-cols-12 gap-4 items-center pl-7 pb-4">
            <div class="col-span-2 flex items-center">
              <img
                src="https://ccecommerce.s3.us-east-1.amazonaws.com/img/${encodeURIComponent(
                  item.name
                )}.jpg"
                alt="${item.name}"
                class="product-image w-20 h-20 rounded border border-gray-200"
              />
            </div>
            <div class="col-span-6">
              <p class="product-name text-sm font-medium text-gray-900">
                ${item.name}
              </p>
            </div>
            <div class="product-detail col-span-3 text-end text-base font-bold text-gray-900">
              ${item.qty} x Rp ${item.price.toLocaleString("id-ID")}
            </div>
          </div>
        `;
          container.innerHTML += itemHtml;
        });
      } else {
        total_harga = Number(result.total_price);
        const itemHtml = `
        <div class="header store-name px-2 py-4 flex items-center">
          <label class="ms-5 text-md font-bold text-gray-900">
            ${result.store}
          </label>
        </div>
        <div class="content grid grid-cols-12 gap-4 items-center pl-7 pb-4">
          <div class="col-span-2 flex items-center">
            <img
              src="https://ccecommerce.s3.us-east-1.amazonaws.com/img/${encodeURIComponent(
          result.name
        )}.jpg"
              alt="${result.name}"
              class="product-image w-20 h-20 rounded border border-gray-200"
            />
          </div>
          <div class="col-span-6">
            <p class="product-name text-sm font-medium text-gray-900">
              ${result.name}
            </p>
          </div>
          <div class="product-detail col-span-3 text-end text-base font-bold text-gray-900">
            ${result.qty} x Rp ${result.price.toLocaleString("id-ID")}
          </div>
        </div>
      `;
        container.innerHTML += itemHtml;
      }

      total_harga_text.innerHTML =
        "Rp " + Number(total_harga).toLocaleString("id-ID");
      updateTotalTagihan();
    } catch (error) {
      console.error("Fetch error:", error);
    }
  }

  fetchData();
});

// Ekspedisi
const ekspedisiDropdown = document.getElementById("ekspedisiDropdown");
const ongkirDetail = document.querySelector(".ongkir");

const ekspedisiData = {
  reguler: {
    ongkir: 21500,
  },
  kargo: {
    ongkir: 60000,
  },
  ekonomi: {
    ongkir: 14000,
  },
};

const biayaPlatform = 1000;

function updateTotalTagihan() {
  const ongkir = parseInt(ongkirDetail.textContent.replace(/\D/g, ""), 10) || 0;
  const totalTagihan = Number(total_harga) + ongkir + biayaPlatform;

  document.querySelector(".total-tagihan").textContent =
    "Rp " + totalTagihan.toLocaleString("id-ID");
    tmpTagihan = totalTagihan;
}

document.addEventListener("DOMContentLoaded", () => {
  ekspedisiDropdown.value = "reguler";
  ongkirDetail.textContent =
    "Rp " + ekspedisiData["reguler"].ongkir.toLocaleString("id-ID");
  updateTotalTagihan();
});

ekspedisiDropdown.addEventListener("change", () => {
  const selectedValue = ekspedisiDropdown.value;
  if (selectedValue && ekspedisiData[selectedValue]) {
    ongkirDetail.textContent =
      "Rp " + ekspedisiData[selectedValue].ongkir.toLocaleString("id-ID");
    updateTotalTagihan();
  }
});

    // Metode pembayaran
    const pembayaranDropdown = document.getElementById("pembayaranDropdown");
    const pembayaranDetail = document.getElementById("pembayaranDetail");
    const pembayaranName = document.getElementById("pembayaranName");
    const pembayaranInfo = document.getElementById("pembayaranInfo");

    const pembayaranData = {
      transfer: {
        name: "Transfer Bank",
        info: "Pembayaran melalui rekening bank seperti BCA, Mandiri, atau BNI. Pastikan menyertakan nomor virtual account saat transfer.",
      },
      cod: {
        name: "Bayar di Tempat (COD)",
        info: "Bayar langsung kepada kurir saat barang diterima. Harap siapkan uang tunai yang pas.",
      },
      ewallet: {
        name: "E-Wallet",
        info: "Pembayaran melalui dompet digital seperti OVO, GoPay, atau Dana. Pastikan saldo mencukupi.",
      },
    };

    pembayaranDropdown.addEventListener("change", () => {
      const selectedValue = pembayaranDropdown.value;
      if (selectedValue && pembayaranData[selectedValue]) {
        pembayaranDetail.classList.remove("hidden");
        pembayaranName.textContent = pembayaranData[selectedValue].name;
        pembayaranInfo.textContent = pembayaranData[selectedValue].info;
      } else {
        pembayaranDetail.classList.add("hidden");
      }
    });
    document.addEventListener("DOMContentLoaded", () => {
  const addAddressModal = document.getElementById("input-alamat-modal");
  const addAddressForm = addAddressModal.querySelector("form");
  const cancelButton = document.getElementById("cancelInputAlamat");
  const loader = document.getElementById("fullscreen-loader");

  // Tombol "Batal"
  cancelButton.addEventListener("click", () => {
    addAddressModal.classList.add("hidden");
  });

  // Tombol "Simpan"
  addAddressForm.addEventListener("submit", async (event) => {
    event.preventDefault();

    // Tampilkan loader
    loader.classList.remove("hidden");
    document.body.classList.add("no-scroll");

    try {
      // Ambil data dari input form
      const name = document.getElementById("Nama").value;
      const phone = document.getElementById("Telepon").value;
      const address = document.getElementById("Alamat").value;
      const kelurahan = document.getElementById("Kelurahan").value;
      const kecamatan = document.getElementById("Kecamatan").value;
      const kota = document.getElementById("Kota").value;
      const provinsi = document.getElementById("Provinsi").value;
      const kodePos = document.getElementById("KodePos").value;

      // Validasi input
      if (
        !name ||
        !phone ||
        !address ||
        !kelurahan ||
        !kecamatan ||
        !kota ||
        !provinsi ||
        !kodePos
      ) {
        alert("Semua data harus diisi.");
        loader.classList.add("hidden");
        document.body.classList.remove("no-scroll");
        return;
      }

      // Panggil API Lambda
      const response = await fetch(
        `https://bk5mxpz366.execute-api.us-east-1.amazonaws.com/default/add_address?name=${encodeURIComponent(
          name
        )}&phone=${encodeURIComponent(phone)}&address=${encodeURIComponent(
          address
        )}&kelurahan=${encodeURIComponent(
          kelurahan
        )}&kecamatan=${encodeURIComponent(
          kecamatan
        )}&kota=${encodeURIComponent(kota)}&provinsi=${encodeURIComponent(
          provinsi
        )}&kode_pos=${encodeURIComponent(kodePos)}`,
        { method: "GET" }
      );

      const result = await response.json();

      if (response.ok && result.success) {
        Swal.fire({
          title: "Success!",
          text: result.message,
          icon: "success",
          confirmButtonText: "OK",
          buttonsStyling: false,
          customClass: {
            confirmButton:
              "bg-purple-500 text-white px-4 py-2 rounded-md hover:bg-purple-800",
          },
        });

        // Reset form dan sembunyikan modal
        addAddressForm.reset();
        addAddressModal.classList.add("hidden");
      } else {
        Swal.fire({
          title: "Failed",
          text: result.message || "Gagal menambahkan alamat.",
          icon: "error",
          confirmButtonText: "OK",
          buttonsStyling: false,
          customClass: {
            confirmButton:
              "bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-800",
          },
        });
      }
    } catch (error) {
      console.error("Error adding address:", error);
      Swal.fire({
        title: "Error",
        text: "Terjadi kesalahan saat menambahkan alamat.",
        icon: "error",
        confirmButtonText: "OK",
        buttonsStyling: false,
        customClass: {
          confirmButton:
            "bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-800",
        },
      });
    } finally {
      // Sembunyikan loader
      loader.classList.add("hidden");
      document.body.classList.remove("no-scroll");
      fetchAddresses();
    }
  });
});

  // Fungsi untuk mengambil alamat
  const fetchAddresses = async () => {
    try {
      const response = await fetch(
        "https://ewml8foh5d.execute-api.us-east-1.amazonaws.com/default/get_address"
      );
      const addresses = await response.json();

      console.log("Fetched addresses:", addresses); // Debug: Cek data yang diterima dari API

      if (!addresses || addresses.length === 0) {
        console.error("No addresses found or API failed.");
        return;
      }

      const container = document.getElementById("addresses-container");
      container.innerHTML = ""; // Kosongkan kontainer sebelum menambahkan elemen

      let defaultAddress = null;

      addresses.forEach((address, index) => {
        console.log(`Rendering address: ${address.id_address}`); // Debug: Cek setiap alamat yang sedang diproses

        // Buat elemen HTML untuk setiap alamat
        const addressDiv = document.createElement("div");
        addressDiv.className =
          "w-full px-4 py-3 rounded-lg ring-2 ring-gray-200 flex items-start space-x-4";

        addressDiv.innerHTML = `
          <input
            id="default-radio-${address.id_address}"
            type="radio"
            value="${address.id_address}"
            name="default-radio"
            data-modal-hide="authentication-modal"
            class="w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500"
            ${index === 0 ? "checked" : ""}
          />
          <div>
            <p class="informasi text-md font-semibold text-gray-800">
              ${address.name} | ${address.phone}
            </p>
            <p class="lokasi text-sm text-gray-600">
              ${address.address}, ${address.kecamatan}, ${address.kelurahan}, ${address.kota}, ${address.provinsi}, ${address.kode_pos}
            </p>
          </div>
        `;

        container.appendChild(addressDiv);

        // Set default data untuk elemen pertama
        if (index === 0) {
          defaultAddress = address;
        }
      });

      // Set default nama dan alamat di luar loop
      if (defaultAddress) {
        document.getElementById("nama").textContent = defaultAddress.name;
        document.getElementById("alamat").textContent = `${defaultAddress.address}, ${defaultAddress.kecamatan}, ${defaultAddress.kelurahan}, ${defaultAddress.kota}, ${defaultAddress.provinsi}, ${defaultAddress.kode_pos}`;
      }

      // Menambahkan event listener untuk radio buttons
      const radioButtons = document.querySelectorAll("input[name='default-radio']");
      radioButtons.forEach((radio) => {
        radio.addEventListener("change", (event) => {
          console.log("Radio button changed:", event.target); // Debug: Cek event ketika radio button berubah

          const selectedAddressId = event.target.value;
          console.log("Selected address ID:", selectedAddressId); // Debug: Cek ID alamat yang dipilih

          const selectedAddress = addresses.find(
            (address) => address.id_address === selectedAddressId
          );

          if (selectedAddress) {
            console.log("Selected address:", selectedAddress); // Debug: Cek alamat yang dipilih

            // Update nama dan alamat sesuai pilihan
            document.getElementById("nama").textContent = selectedAddress.name;
            document.getElementById("alamat").textContent = `${selectedAddress.address}, ${selectedAddress.kecamatan}, ${selectedAddress.kelurahan}, ${selectedAddress.kota}, ${selectedAddress.provinsi}, ${selectedAddress.kode_pos}`;
          }
        });
      });
    } catch (error) {
      console.error("Failed to fetch addresses: ", error);
    }
  };

  // Panggil fungsi untuk memuat data alamat
  fetchAddresses();

  </script>
</html>
